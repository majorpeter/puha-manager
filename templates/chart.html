{% include "header.html" %}
<main>
    <div class="container">
        <div class="section">
            <div class="row">
                <div class="col s12">
                    <div class="card">
                        <div class="card-content">
                            <span class="card-title">{{ chart_title|default('Chart') }}</span>
                            <div class="chart-container" style="max-width: {{ chart_width|default('400px') }}; margin: 0 auto;">
                                <canvas id="chart" width="400" height="400"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
var chart_last_timestamp = {{ chart_last_timestamp }};

var ctx = document.getElementById("chart").getContext('2d');
var config = {
    type: 'line',
    data: {
        labels: {{ chart_labels_json|safe }},
        datasets: [{
            data: {{ chart_data_json }},
        }]
    },
    options: {
        legend: {
            display: false
        },
        scales: {
        {% if y_scale_label %}
           yAxes: [{
                scaleLabel: {
                    display: true,
                    labelString: '{{ y_scale_label }}'
                }
            }],
        {% endif %}
        },
    }
};
var myChart = new Chart(ctx, config);

function append_new_chart_data() {
    $.post('/chart', {last_timestamp: chart_last_timestamp}, function(data) {
        for (key in data['data']) {
            config.data.labels.push(data['label'][key]);
            config.data.datasets[0].data.push(data['data'][key]);
        }
        myChart.update();
        chart_last_timestamp = data['last_timestamp'];
    });
};

setInterval(append_new_chart_data, 3000);
</script>
{% include "footer.html" %}
